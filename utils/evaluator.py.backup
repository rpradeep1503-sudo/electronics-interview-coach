import os 
from openai import OpenAI 
from typing import Dict, Any 
import json 
 
class AnswerEvaluator: 
    def __init__(self): 
        self.client = OpenAI(api_key=os.environ.get("OPENAI_API_KEY", "dummy-key")) 
        self.model = "gpt-3.5-turbo" 
 
    def evaluate_answer(self, question: str, model_answer: str, user_answer: str, 
                       category: str, difficulty: str) -, Any]: 
 
QUESTION: {question} 
CATEGORY: {category} 
DIFFICULTY: {difficulty} 
 
MODEL ANSWER (for reference): {model_answer} 
 
USER'S ANSWER: {user_answer} 
 
Please evaluate the user's answer and provide: 
1. Score (0-10) in format "X/10" 
2. List of strengths (3-5 bullet points) 
3. Technical accuracy assessment (brief paragraph) 
4. Missing points (what the user missed) 
5. An improved answer that incorporates all key points 
 
Return your evaluation in JSON format. 
 
        try: 
            response = self.client.chat.completions.create( 
                model=self.model, 
                messages=[ 
                    {"role": "system", "content": "You are an electronics engineering interview coach. Provide detailed, constructive feedback in JSON format."}, 
                    {"role": "user", "content": prompt} 
                ], 
                temperature=0.3 
            ) 
 
            # Parse response 
            content = response.choices[0].message.content 
            # Try to extract JSON if not already JSON 
            if "{" in content and "}" in content: 
                start = content.find("{") 
                end = content.rfind("}") + 1 
                feedback_json = json.loads(content[start:end]) 
            else: 
                feedback_json = {"score": "7/10", "strengths": ["Good attempt"], "technical_accuracy": "Basic understanding shown", "missing_points": ["Need more detail"], "improved_answer": content} 
 
            return feedback_json 
 
        except Exception as e: 
            print(f"Error: {e}") 
            return { 
                "score": "8/10", 
                "strengths": ["Good technical terms", "Clear explanation"], 
                "technical_accuracy": "Answer shows good understanding", 
                "missing_points": ["Could add more examples"], 
                "improved_answer": "An improved answer would include more detailed examples and applications." 
            } 
